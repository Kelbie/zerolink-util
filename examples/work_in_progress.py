import sys
sys.path.append('..')

import rsa
from zerolink import client

keys = (rsa.key.PublicKey(92091189085804565643648259020907050963541685219663339896747641013482093929493276068564912886312959910871152158592445460101555914656566401819447692525519556854214682541229604537189606147159043635273741817303568419145782968789006476387432598586464388509784883331797242321035425684507310396413791118662080133161, 65537), rsa.key.PrivateKey(92091189085804565643648259020907050963541685219663339896747641013482093929493276068564912886312959910871152158592445460101555914656566401819447692525519556854214682541229604537189606147159043635273741817303568419145782968789006476387432598586464388509784883331797242321035425684507310396413791118662080133161, 65537, 58406247987418813357008100556998360823650916980565279503308294531720756735575141062146582909190200630107564268610021751821431734633873727690088682134689556767302961944057501470934924787147854631072077941635348689088509074025899737373159409528388129286237426077934882039092481839038171288595893466510328564853, 33171227496662737855106561317600774174404630045384918809725512219610698919493310713461547776299609867572161369631865378951851309812843296138660575975520727473177419, 2776236999220773373140933690925524647668335175416487435611062669507364021793448821697160826121360088003829619658738359141620579567790532047033819))

r = 1234567890

outputScriptHex = int("0014d4246b7315b5f8083c45dd250ef8dd9c69efb6ff", 16)
changeOutputAddress = "tb1q6sjxkuc4khuqs0z9m5jsa7xan357ldhln6perd"

blindedOutputScriptHex = keys[0].blind(outputScriptHex, r)
blindedOutputScriptHex = str(format(blindedOutputScriptHex, 'x'))

zl = client.ZeroLink(blindedOutputScriptHex, changeOutputAddress)

txid = "16bcb1754380b532646d12fe4d8ad644cfc6ea1d6b7fae06d6c1fa997e00c559"
vout = 0
proof = "ICxkqbhPrKwukCV9Q0nTgRgETAWbR+fTiYjVf8t5H+l6IaMIi6OBQQoNvTX83g12hZNZAUEIXcaXO1Bz5cAnthI="

zl.addInput(txid, vout, proof)

status = zl.postInputs()
# {
#     'blindedOutputSignature': 'TgtGKqEIZDNljEM02aCH9OY1UG7zFKdhNMzdfc+OAmvXWRQu0QHNZOiCV/yAGSILg9K9yhnLlZ+E8H+XnA7t+qDhGO0Whwhz8VJVqDr4TZUav2Wrx8cYmuye9WwYcDJovoK8Bw+SyAZSjaljXRny5rNXDVT293RSIwrCeKELY5P080QQ1OyZjBGqGU806XYEmYy9pL+0ThQGMvu63esSWtHAm/n+8ZHCzaCEQvEdxWbaAaPOXbv0ZUU6gwm2YZUuUz2fTM5mkjfrALb+OlfB9ziE1pBM+dE0MvNyLc2hzELXpSNZvsg3AoAy/E/d67gzgluDoW0XbMJohtxGd1H/Fg==',
#     'uniqueId': 'b0eb6cac31f64d538cb138bfe5649105',
#     'roundId': 1
# }

zl.postConfirmation(loop=True)
